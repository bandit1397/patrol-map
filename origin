/* ✅ 검색 */
function searchAndShow(){
  const kw=document.getElementById("keyword").value.trim();
  if(!kw){ alert("⚠️ 키워드 입력하세요."); return; }
  clearMarkers();
  const kwNoSpace=kw.replace(/\s+/g,"").toLowerCase();
  if(kwNoSpace.length<2){ alert("⚠️ 최소 2글자 이상 입력"); return; }

  const res=Object.keys(lampData).filter(id=>{
    const d=lampData[id];
    const name=normalizeText(d.고유이름);
    if(name===kwNoSpace) return true;
    if(/^l\d+$/i.test(d.고유이름)&&d.고유이름.toLowerCase().endsWith(kwNoSpace)) return true;
    if(isSequenceMatch(name,kwNoSpace)) return true;
    if(normalizeText(d.전화번호).includes(kwNoSpace)) return true;
    if([d.주소,d.분류,d.특이사항].some(f=>isSequenceMatch(normalizeText(f),kwNoSpace))) return true;
    return false;
  }).map(id=>({id,pos:parseCoords(lampData[id].좌표)}));

  if(res.length===0){ alert("❌ 검색 결과 없음"); return; }
  const bounds=new google.maps.LatLngBounds();
  res.forEach(r=>{addMarker(r.id,r.pos,"blue");bounds.extend(r.pos);});
  map.fitBounds(bounds);
}

function initMap(){
  map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.3857,lng:126.6586},zoom:15});
  infoWindow=new google.maps.InfoWindow();
  map.addListener("click",e=>{
    lastClickedCoord=`${e.latLng.lat().toFixed(6)},${e.latLng.lng().toFixed(6)}`;
    document.getElementById("clickedCoords").innerText=`📍 클릭 좌표: ${lastClickedCoord}`;
  });
}
function copyCoords(){ if(!lastClickedCoord){ alert("⚠️ 먼저 지도를 클릭하세요."); return; } navigator.clipboard.writeText(lastClickedCoord).then(()=>alert("✅ 복사됨: "+lastClickedCoord)); }
function clearMarkers(){ markers.forEach(m=>m.setMap(null)); markers=[]; }
function addMarker(id,pos,color){
  const m=new google.maps.Marker({position:pos,map,label:id,icon:{url:`http://maps.google.com/mapfiles/ms/icons/${color}-dot.png`}});
  m.addListener("click", () => {
    const data = lampData[id];
    infoWindow.setContent(`
      <div style="min-width:150px;">
        <strong>${data.고유이름}</strong><br/>
        <b>분류:</b> ${data.분류}<br/>
        <b>전화번호:</b> ${data.전화번호}<br/>
        <b>주소:</b> ${data.주소}<br/>
        <b>특이사항:</b> ${data.특이사항}
      </div>
  `  );
    infoWindow.open(map, m);
  });
  m.addListener("dblclick",()=>{const c=lampData[id].좌표.split(",");window.open(`https://www.google.com/maps/dir/?api=1&destination=${c[0]},${c[1]}`,"_blank");});
  markers.push(m);
}
